<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≤‡∏Ç‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .file-upload-area {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
        }
        .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .file-upload-area.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-4">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≤‡∏Ç‡∏≤</h1>
            <p class="text-gray-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
        </div>

        <!-- Example Image Card -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="mr-2">üìã</span> ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ IP Address ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
            </h2>
            <div class="bg-gray-50 rounded-lg p-4 border-2 border-dashed border-gray-300">
                <div class="text-center">
                    <div id="exampleImageContainer">
                        <!-- ‚≠ê ‡πÉ‡∏™‡πà URL ‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á IP Address ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á src="" -->
                        <!-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: src="https://example.com/ip-example.jpg" -->
                        <img id="exampleImage" class="mx-auto max-w-full max-h-64 rounded-lg shadow-md mb-4" 
                             src="https://lh3.googleusercontent.com/d/1MdYAe4NB6mzN9k8SWYVf5tHA6caP0603" alt="‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á IP Address"
                             onerror="this.style.display='none'; document.getElementById('imageError').style.display='block';">
                        <div id="imageError" class="hidden text-red-500 text-sm mb-4">
                            ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL
                        </div>
                    </div>
                    <p class="text-sm text-gray-600">
                        <strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á IP Address ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ipconfig ‡∏´‡∏£‡∏∑‡∏≠ Network Settings
                    </p>
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
            <form id="branchForm" class="space-y-6">
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            üè¢ ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="branchCode" required maxlength="2" pattern="[A-Za-z‡∏Å-‡∏Æ0-9]{2}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                               placeholder="‡πÄ‡∏ä‡πà‡∏ô A1, B2, ‡∏Å1">
                        <p class="text-xs text-gray-500 mt-1">2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£: A-Z, ‡∏Å-‡∏Æ, 0-9</p>
                    </div>

                    <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            üè™ ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤ <span class="text-red-500">*</span>
                        </label>
                        <div class="flex">
                            <span class="inline-flex items-center px-3 text-sm text-gray-900 bg-gray-200 border border-r-0 border-gray-300 rounded-l-lg">
                                ‡∏™‡∏≤‡∏Ç‡∏≤
                            </span>
                            <input type="text" id="branchName" required
                                   class="flex-1 px-4 py-3 border border-gray-300 rounded-r-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏µ‡∏•‡∏°, ‡∏ö‡∏≤‡∏á‡∏ô‡∏≤, ‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏£‡∏±‡∏•">
                        </div>
                    </div>

                    <!-- ‡πÄ‡∏Ç‡∏ï -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            üìç ‡πÄ‡∏Ç‡∏ï <span class="text-red-500">*</span>
                        </label>
                        <select id="district" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï</option>
                            <option value="K012">K012</option>
                            <option value="K122">K122</option>
                            <option value="K189">K189</option>
                            <option value="K195">K195</option>
                            <option value="K196">K196</option>
                            <option value="K247">K247</option>
                            <option value="K273">K273</option>
                            <option value="K358">K358</option>
                        </select>
                    </div>

                    <!-- IP Address -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            üíª IP Address (‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå) <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="ipAddress" required pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                               placeholder="‡πÄ‡∏ä‡πà‡∏ô 192.168.1.100">
                        <p class="text-xs text-gray-500 mt-1">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: xxx.xxx.xxx.xxx</p>
                    </div>
                </div>

                <!-- ‡∏£‡∏π‡∏õ IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        üì∏ ‡∏£‡∏π‡∏õ IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á <span class="text-red-500">*</span>
                    </label>
                    <div class="file-upload-area rounded-lg p-6 text-center cursor-pointer" id="uploadArea">
                        <input type="file" id="imageFile" accept="image/*" class="hidden" required>
                        <div id="uploadContent">
                            <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="text-gray-600 mb-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                            <p class="text-xs text-gray-500">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: JPG, PNG, GIF (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)</p>
                        </div>
                        <div id="imagePreview" class="hidden">
                            <img id="previewImg" class="mx-auto max-w-xs max-h-48 rounded-lg shadow-md mb-2">
                            <p id="fileName" class="text-sm text-gray-600 mb-2"></p>
                            <button type="button" id="removeImage" class="text-red-500 hover:text-red-700 text-sm">
                                üóëÔ∏è ‡∏•‡∏ö‡∏£‡∏π‡∏õ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-center pt-4">
                    <button type="submit" 
                            class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold px-8 py-3 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                </div>
            </form>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-white rounded-2xl shadow-xl mb-6">
            <div class="flex border-b">
                <button id="dashboardTab" class="flex-1 py-4 px-6 text-center font-semibold text-blue-600 border-b-2 border-blue-600 bg-blue-50">
                    üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                </button>
                <button id="dataTab" class="flex-1 py-4 px-6 text-center font-semibold text-gray-600 hover:text-blue-600 hover:bg-gray-50">
                    üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß
                </button>
                <button id="logTab" class="flex-1 py-4 px-6 text-center font-semibold text-gray-600 hover:text-blue-600 hover:bg-gray-50">
                    üìù Log ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                </button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="space-y-6">
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl p-6 text-white shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm font-medium">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p id="totalBranches" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-blue-400 bg-opacity-30 rounded-full p-3">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-2xl p-6 text-white shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm font-medium">‡πÄ‡∏Ç‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p id="totalDistricts" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-green-400 bg-opacity-30 rounded-full p-3">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-2xl p-6 text-white shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm font-medium">IP Address</p>
                            <p id="totalIPs" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-purple-400 bg-opacity-30 rounded-full p-3">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-2xl p-6 text-white shadow-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-100 text-sm font-medium">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
                            <p id="totalImages" class="text-3xl font-bold">0</p>
                        </div>
                        <div class="bg-orange-400 bg-opacity-30 rounded-full p-3">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- District Summary -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800">üìç ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÄ‡∏Ç‡∏ï</h2>
                    <button id="downloadDistrictBtn" 
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-2 rounded-lg shadow-md transform hover:scale-105 transition-all duration-200">
                        üì• Download ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏Ç‡∏ï
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡πÄ‡∏Ç‡∏ï</th>
                                <th class="border border-gray-200 px-4 py-3 text-center font-semibold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤</th>
                                <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤</th>
                                <th class="border border-gray-200 px-4 py-3 text-center font-semibold text-gray-700">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</th>
                            </tr>
                        </thead>
                        <tbody id="districtSummaryTable">
                            <!-- District summary will be inserted here -->
                        </tbody>
                    </table>
                </div>
                
                <div id="noDistrictData" class="text-center py-8 text-gray-500">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- District Chart -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">üìä ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤‡∏ï‡πà‡∏≠‡πÄ‡∏Ç‡∏ï</h3>
                    <div id="districtChart" class="h-64 flex items-center justify-center">
                        <canvas id="districtCanvas" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-2xl shadow-xl p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">üïí ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                    <div id="recentActivity" class="space-y-3 max-h-64 overflow-y-auto">
                        <!-- Recent activities will be inserted here -->
                    </div>
                    <div id="noRecentActivity" class="text-center py-8 text-gray-500">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div id="dataSection" class="bg-white rounded-2xl shadow-xl p-6 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß</h2>
                <button id="downloadBtn" 
                        class="bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded-lg shadow-md transform hover:scale-105 transition-all duration-200">
                    üì• Download Excel
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤</th>
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤</th>
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡πÄ‡∏Ç‡∏ï</th>
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">IP Address</th>
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡∏£‡∏π‡∏õ IP</th>
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
                            <th class="border border-gray-200 px-4 py-3 text-center font-semibold text-gray-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable">
                        <!-- Data will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <div id="noData" class="text-center py-8 text-gray-500">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            </div>
        </div>

        <!-- Log Section -->
        <div id="logSection" class="bg-white rounded-2xl shadow-xl p-6 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800">üìù Log ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</h2>
                <button id="downloadLogBtn" 
                        class="bg-purple-600 hover:bg-purple-700 text-white font-semibold px-6 py-2 rounded-lg shadow-md transform hover:scale-105 transition-all duration-200">
                    üì• Download Log Excel
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</th>
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤</th>
                            <th class="border border-gray-200 px-4 py-3 text-left font-semibold text-gray-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                        </tr>
                    </thead>
                    <tbody id="logTable">
                        <!-- Log data will be inserted here -->
                    </tbody>
                </table>
            </div>
            
            <div id="noLog" class="text-center py-8 text-gray-500">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Log ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤</h3>
                <button id="closeEditModal" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <form id="editForm" class="space-y-6">
                <input type="hidden" id="editIndex">
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            üè¢ ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="editBranchCode" required maxlength="2" pattern="[A-Za-z‡∏Å-‡∏Æ0-9]{2}"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <p class="text-xs text-gray-500 mt-1">2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£: A-Z, ‡∏Å-‡∏Æ, 0-9</p>
                    </div>

                    <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            üè™ ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤ <span class="text-red-500">*</span>
                        </label>
                        <div class="flex">
                            <span class="inline-flex items-center px-3 text-sm text-gray-900 bg-gray-200 border border-r-0 border-gray-300 rounded-l-lg">
                                ‡∏™‡∏≤‡∏Ç‡∏≤
                            </span>
                            <input type="text" id="editBranchName" required
                                   class="flex-1 px-4 py-3 border border-gray-300 rounded-r-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                    </div>

                    <!-- ‡πÄ‡∏Ç‡∏ï -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            üìç ‡πÄ‡∏Ç‡∏ï <span class="text-red-500">*</span>
                        </label>
                        <select id="editDistrict" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï</option>
                            <option value="K012">K012</option>
                            <option value="K122">K122</option>
                            <option value="K189">K189</option>
                            <option value="K195">K195</option>
                            <option value="K196">K196</option>
                            <option value="K247">K247</option>
                            <option value="K273">K273</option>
                            <option value="K358">K358</option>
                        </select>
                    </div>

                    <!-- IP Address -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            üíª IP Address (‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå) <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="editIpAddress" required pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <p class="text-xs text-gray-500 mt-1">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: xxx.xxx.xxx.xxx</p>
                    </div>
                </div>

                <!-- ‡∏£‡∏π‡∏õ IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        üì∏ ‡∏£‡∏π‡∏õ IP ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
                    </label>
                    <div class="mb-4">
                        <img id="currentImage" class="max-w-xs max-h-48 rounded-lg shadow-md">
                        <p class="text-sm text-gray-600 mt-2">‡∏£‡∏π‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                    </div>
                    <div class="file-upload-area rounded-lg p-6 text-center cursor-pointer" id="editUploadArea">
                        <input type="file" id="editImageFile" accept="image/*" class="hidden">
                        <div id="editUploadContent">
                            <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="text-gray-600 mb-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</p>
                            <p class="text-xs text-gray-500">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: JPG, PNG, GIF (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB)</p>
                        </div>
                        <div id="editImagePreview" class="hidden">
                            <img id="editPreviewImg" class="mx-auto max-w-xs max-h-48 rounded-lg shadow-md mb-2">
                            <p id="editFileName" class="text-sm text-gray-600 mb-2"></p>
                            <button type="button" id="removeEditImage" class="text-red-500 hover:text-red-700 text-sm">
                                üóëÔ∏è ‡∏•‡∏ö‡∏£‡∏π‡∏õ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-center gap-4 pt-4">
                    <button type="button" id="cancelEdit" 
                            class="bg-gray-500 hover:bg-gray-600 text-white font-semibold px-6 py-3 rounded-lg transition-all duration-200">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                    <button type="submit" 
                            class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold px-8 py-3 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Load saved data from localStorage
        let savedData = JSON.parse(localStorage.getItem('branchData')) || [];
        let logData = JSON.parse(localStorage.getItem('logData')) || [];

        // File upload handling
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('imageFile');
        const uploadContent = document.getElementById('uploadContent');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const fileName = document.getElementById('fileName');
        const removeImageBtn = document.getElementById('removeImage');

        // Click to upload
        uploadArea.addEventListener('click', () => {
            if (!imagePreview.classList.contains('hidden')) return;
            fileInput.click();
        });

        // Drag and drop
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // Handle file upload
        function handleFile(file) {
            // Validate file type
            if (!file.type.startsWith('image/')) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                return;
            }

            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                fileName.textContent = file.name;
                uploadContent.classList.add('hidden');
                imagePreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        // Remove image
        removeImageBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            fileInput.value = '';
            uploadContent.classList.remove('hidden');
            imagePreview.classList.add('hidden');
        });

        // Display data in table
        function displayData() {
            const tableBody = document.getElementById('dataTable');
            const noDataDiv = document.getElementById('noData');
            
            if (savedData.length === 0) {
                tableBody.innerHTML = '';
                noDataDiv.style.display = 'block';
                return;
            }
            
            noDataDiv.style.display = 'none';
            tableBody.innerHTML = savedData.map((item, index) => `
                <tr class="hover:bg-gray-50">
                    <td class="border border-gray-200 px-4 py-3">${item.branchCode}</td>
                    <td class="border border-gray-200 px-4 py-3">${item.branchName}</td>
                    <td class="border border-gray-200 px-4 py-3">${item.district}</td>
                    <td class="border border-gray-200 px-4 py-3 font-mono">${item.ipAddress}</td>
                    <td class="border border-gray-200 px-4 py-3">
                        <button onclick="viewImage('${item.imageData}')" 
                                class="text-blue-600 hover:text-blue-800 underline">‡∏î‡∏π‡∏£‡∏π‡∏õ</button>
                    </td>
                    <td class="border border-gray-200 px-4 py-3">${item.timestamp}</td>
                    <td class="border border-gray-200 px-4 py-3 text-center">
                        <button onclick="editData(${index})" 
                                class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm mr-2">
                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button onclick="deleteData(${index})" 
                                class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Display log data
        function displayLogData() {
            const logTableBody = document.getElementById('logTable');
            const noLogDiv = document.getElementById('noLog');
            
            if (logData.length === 0) {
                logTableBody.innerHTML = '';
                noLogDiv.style.display = 'block';
                return;
            }
            
            noLogDiv.style.display = 'none';
            logTableBody.innerHTML = logData.map(log => `
                <tr class="hover:bg-gray-50">
                    <td class="border border-gray-200 px-4 py-3">${log.timestamp}</td>
                    <td class="border border-gray-200 px-4 py-3">${log.user}</td>
                    <td class="border border-gray-200 px-4 py-3">
                        <span class="px-2 py-1 rounded text-xs font-semibold ${log.action === '‡πÄ‡∏û‡∏¥‡πà‡∏°' ? 'bg-green-100 text-green-800' : log.action === '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                            ${log.action}
                        </span>
                    </td>
                    <td class="border border-gray-200 px-4 py-3">${log.branchCode}</td>
                    <td class="border border-gray-200 px-4 py-3 text-sm">${log.details}</td>
                </tr>
            `).reverse().join('');
        }

        // Add log entry
        function addLog(action, branchCode, branchName, details) {
            const user = `${branchCode}-${branchName.replace('‡∏™‡∏≤‡∏Ç‡∏≤', '')}`;
            const logEntry = {
                timestamp: new Date().toLocaleString('th-TH'),
                user: user,
                action: action,
                branchCode: branchCode,
                details: details
            };
            
            logData.push(logEntry);
            localStorage.setItem('logData', JSON.stringify(logData));
        }

        // View image function
        function viewImage(imageData) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-4 max-w-2xl max-h-[90vh] overflow-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">‡∏£‡∏π‡∏õ IP Address</h3>
                        <button onclick="this.closest('.fixed').remove()" 
                                class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                    </div>
                    <img src="${imageData}" class="max-w-full h-auto rounded-lg">
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Form submission
        document.getElementById('branchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!fileInput.files[0]) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ IP Address');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const formData = {
                    branchCode: document.getElementById('branchCode').value,
                    branchName: '‡∏™‡∏≤‡∏Ç‡∏≤' + document.getElementById('branchName').value,
                    district: document.getElementById('district').value,
                    ipAddress: document.getElementById('ipAddress').value,
                    imageData: e.target.result,
                    imageName: fileInput.files[0].name,
                    timestamp: new Date().toLocaleString('th-TH')
                };
                
                // Validate branch code format
                const branchCodePattern = /^[A-Za-z‡∏Å-‡∏Æ0-9]{2}$/;
                if (!branchCodePattern.test(formData.branchCode)) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (A-Z, ‡∏Å-‡∏Æ, 0-9)');
                    return;
                }
                
                // Validate IP format
                const ipPattern = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
                if (!ipPattern.test(formData.ipAddress)) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å IP Address ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô 192.168.1.100)');
                    return;
                }
                
                // Check for duplicate branch code
                if (savedData.some(item => item.branchCode === formData.branchCode)) {
                    alert('‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏∑‡πà‡∏ô');
                    return;
                }
                
                // Save data
                savedData.push(formData);
                localStorage.setItem('branchData', JSON.stringify(savedData));
                
                // Add log entry
                addLog('‡πÄ‡∏û‡∏¥‡πà‡∏°', formData.branchCode, formData.branchName, `‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà IP: ${formData.ipAddress}, ‡πÄ‡∏Ç‡∏ï: ${formData.district}`);
                
                // Reset form and refresh display
                document.getElementById('branchForm').reset();
                fileInput.value = '';
                uploadContent.classList.remove('hidden');
                imagePreview.classList.add('hidden');
                displayData();
                displayLogData();
                updateDashboard();
                
                // Show success message
                alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            };
            reader.readAsDataURL(fileInput.files[0]);
        });

        // Download Excel function
        document.getElementById('downloadBtn').addEventListener('click', function() {
            if (savedData.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î');
                return;
            }
            
            // Request password for download
            const password = prompt('üîê ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel:');
            
            // Check password
            if (password !== '348900Ty') {
                if (password !== null) { // User didn't cancel
                    alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ');
                }
                return;
            }
            
            // Prepare data for Excel
            const excelData = savedData.map(item => ({
                '‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤': item.branchCode,
                '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤': item.branchName,
                '‡πÄ‡∏Ç‡∏ï': item.district,
                'IP Address': item.ipAddress,
                '‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ': item.imageName,
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å': item.timestamp
            }));
            
            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Set column widths
            ws['!cols'] = [
                { width: 15 }, // ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤
                { width: 25 }, // ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤
                { width: 20 }, // ‡πÄ‡∏Ç‡∏ï
                { width: 18 }, // IP Address
                { width: 25 }, // ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ
                { width: 20 }  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• IP ‡∏™‡∏≤‡∏Ç‡∏≤');
            
            // Generate filename with current date
            const now = new Date();
            const filename = `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•_IP_‡∏™‡∏≤‡∏Ç‡∏≤_${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}.xlsx`;
            
            // Download file
            XLSX.writeFile(wb, filename);
            
            // Show success message
            alert('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
        });



        // Dashboard functions
        function updateDashboard() {
            // Update summary cards
            document.getElementById('totalBranches').textContent = savedData.length;
            
            const uniqueDistricts = [...new Set(savedData.map(item => item.district))];
            document.getElementById('totalDistricts').textContent = uniqueDistricts.length;
            document.getElementById('totalIPs').textContent = savedData.length;
            document.getElementById('totalImages').textContent = savedData.length;
            
            // Update district summary
            displayDistrictSummary();
            
            // Update chart
            drawDistrictChart();
            
            // Update recent activity
            displayRecentActivity();
        }

        function displayDistrictSummary() {
            const districtSummaryTable = document.getElementById('districtSummaryTable');
            const noDistrictData = document.getElementById('noDistrictData');
            
            if (savedData.length === 0) {
                districtSummaryTable.innerHTML = '';
                noDistrictData.style.display = 'block';
                return;
            }
            
            noDistrictData.style.display = 'none';
            
            // Group data by district
            const districtGroups = {};
            savedData.forEach(item => {
                if (!districtGroups[item.district]) {
                    districtGroups[item.district] = [];
                }
                districtGroups[item.district].push(item);
            });
            
            // Sort districts
            const sortedDistricts = Object.keys(districtGroups).sort();
            
            districtSummaryTable.innerHTML = sortedDistricts.map(district => {
                const branches = districtGroups[district];
                const percentage = ((branches.length / savedData.length) * 100).toFixed(1);
                const branchNames = branches.map(b => `${b.branchCode} (${b.branchName})`).join(', ');
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="border border-gray-200 px-4 py-3 font-semibold text-blue-600">${district}</td>
                        <td class="border border-gray-200 px-4 py-3 text-center">
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-semibold">
                                ${branches.length}
                            </span>
                        </td>
                        <td class="border border-gray-200 px-4 py-3 text-sm">${branchNames}</td>
                        <td class="border border-gray-200 px-4 py-3 text-center">
                            <div class="flex items-center justify-center">
                                <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                                </div>
                                <span class="text-sm font-semibold">${percentage}%</span>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function drawDistrictChart() {
            const canvas = document.getElementById('districtCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (savedData.length === 0) {
                ctx.fillStyle = '#9CA3AF';
                ctx.font = '16px Sarabun';
                ctx.textAlign = 'center';
                ctx.fillText('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // Group data by district
            const districtGroups = {};
            savedData.forEach(item => {
                if (!districtGroups[item.district]) {
                    districtGroups[item.district] = 0;
                }
                districtGroups[item.district]++;
            });
            
            const districts = Object.keys(districtGroups).sort();
            const counts = districts.map(d => districtGroups[d]);
            const maxCount = Math.max(...counts);
            
            // Chart dimensions
            const padding = 40;
            const chartWidth = canvas.width - (padding * 2);
            const chartHeight = canvas.height - (padding * 2);
            const barWidth = chartWidth / districts.length;
            
            // Colors for bars
            const colors = ['#3B82F6', '#10B981', '#8B5CF6', '#F59E0B', '#EF4444', '#06B6D4', '#84CC16', '#F97316'];
            
            // Draw bars
            districts.forEach((district, index) => {
                const barHeight = (counts[index] / maxCount) * chartHeight;
                const x = padding + (index * barWidth) + (barWidth * 0.1);
                const y = canvas.height - padding - barHeight;
                const width = barWidth * 0.8;
                
                // Draw bar
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(x, y, width, barHeight);
                
                // Draw district label
                ctx.fillStyle = '#374151';
                ctx.font = '12px Sarabun';
                ctx.textAlign = 'center';
                ctx.fillText(district, x + width/2, canvas.height - padding + 15);
                
                // Draw count label
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 14px Sarabun';
                ctx.fillText(counts[index], x + width/2, y + barHeight/2 + 5);
            });
            
            // Draw title
            ctx.fillStyle = '#1F2937';
            ctx.font = 'bold 14px Sarabun';
            ctx.textAlign = 'center';
            ctx.fillText('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏Ç‡∏ï', canvas.width / 2, 20);
        }

        function displayRecentActivity() {
            const recentActivity = document.getElementById('recentActivity');
            const noRecentActivity = document.getElementById('noRecentActivity');
            
            if (logData.length === 0) {
                recentActivity.innerHTML = '';
                noRecentActivity.style.display = 'block';
                return;
            }
            
            noRecentActivity.style.display = 'none';
            
            // Show last 5 activities
            const recentLogs = logData.slice(-5).reverse();
            
            recentActivity.innerHTML = recentLogs.map(log => {
                const actionColor = log.action === '‡πÄ‡∏û‡∏¥‡πà‡∏°' ? 'text-green-600 bg-green-100' : 
                                  log.action === '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' ? 'text-yellow-600 bg-yellow-100' : 
                                  'text-red-600 bg-red-100';
                
                return `
                    <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                        <div class="flex-shrink-0">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${actionColor}">
                                ${log.action}
                            </span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium text-gray-900">${log.branchCode} - ${log.user}</p>
                            <p class="text-xs text-gray-500 truncate">${log.details}</p>
                            <p class="text-xs text-gray-400">${log.timestamp}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Download district summary
        document.getElementById('downloadDistrictBtn').addEventListener('click', function() {
            if (savedData.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î');
                return;
            }
            
            // Request password for download
            const password = prompt('üîê ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏Ç‡∏ï:');
            
            // Check password
            if (password !== '348900Ty') {
                if (password !== null) { // User didn't cancel
                    alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ');
                }
                return;
            }
            
            // Group data by district
            const districtGroups = {};
            savedData.forEach(item => {
                if (!districtGroups[item.district]) {
                    districtGroups[item.district] = [];
                }
                districtGroups[item.district].push(item);
            });
            
            // Prepare summary data
            const summaryData = Object.keys(districtGroups).sort().map(district => {
                const branches = districtGroups[district];
                const percentage = ((branches.length / savedData.length) * 100).toFixed(1);
                const branchList = branches.map(b => `${b.branchCode} (${b.branchName})`).join(', ');
                
                return {
                    '‡πÄ‡∏Ç‡∏ï': district,
                    '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤': branches.length,
                    '‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå': percentage + '%',
                    '‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤': branchList
                };
            });
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(summaryData);
            
            // Set column widths
            ws['!cols'] = [
                { width: 15 }, // ‡πÄ‡∏Ç‡∏ï
                { width: 15 }, // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤
                { width: 12 }, // ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
                { width: 60 }  // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, '‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏Ç‡∏ï');
            
            // Generate filename
            const now = new Date();
            const filename = `‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡πÄ‡∏Ç‡∏ï_${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}.xlsx`;
            
            // Download file
            XLSX.writeFile(wb, filename);
            
            alert('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏Ç‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
        });

        // Tab switching
        document.getElementById('dashboardTab').addEventListener('click', function() {
            document.getElementById('dashboardSection').classList.remove('hidden');
            document.getElementById('dataSection').classList.add('hidden');
            document.getElementById('logSection').classList.add('hidden');
            
            // Update tab styles
            this.classList.add('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
            this.classList.remove('text-gray-600');
            document.getElementById('dataTab').classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
            document.getElementById('dataTab').classList.add('text-gray-600');
            document.getElementById('logTab').classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
            document.getElementById('logTab').classList.add('text-gray-600');
            
            updateDashboard();
        });

        document.getElementById('dataTab').addEventListener('click', function() {
            document.getElementById('dataSection').classList.remove('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('logSection').classList.add('hidden');
            
            // Update tab styles
            this.classList.add('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
            this.classList.remove('text-gray-600');
            document.getElementById('dashboardTab').classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
            document.getElementById('dashboardTab').classList.add('text-gray-600');
            document.getElementById('logTab').classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
            document.getElementById('logTab').classList.add('text-gray-600');
        });

        document.getElementById('logTab').addEventListener('click', function() {
            document.getElementById('logSection').classList.remove('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('dataSection').classList.add('hidden');
            
            // Update tab styles
            this.classList.add('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
            this.classList.remove('text-gray-600');
            document.getElementById('dashboardTab').classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
            document.getElementById('dashboardTab').classList.add('text-gray-600');
            document.getElementById('dataTab').classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'bg-blue-50');
            document.getElementById('dataTab').classList.add('text-gray-600');
            
            displayLogData();
        });

        // Edit data function
        function editData(index) {
            const item = savedData[index];
            
            // Fill edit form
            document.getElementById('editIndex').value = index;
            document.getElementById('editBranchCode').value = item.branchCode;
            document.getElementById('editBranchName').value = item.branchName.replace('‡∏™‡∏≤‡∏Ç‡∏≤', '');
            document.getElementById('editDistrict').value = item.district;
            document.getElementById('editIpAddress').value = item.ipAddress;
            document.getElementById('currentImage').src = item.imageData;
            
            // Show modal
            document.getElementById('editModal').classList.remove('hidden');
        }

        // Modal controls
        document.getElementById('closeEditModal').addEventListener('click', function() {
            document.getElementById('editModal').classList.add('hidden');
        });

        document.getElementById('cancelEdit').addEventListener('click', function() {
            document.getElementById('editModal').classList.add('hidden');
        });

        // Edit form file upload handling
        const editUploadArea = document.getElementById('editUploadArea');
        const editFileInput = document.getElementById('editImageFile');
        const editUploadContent = document.getElementById('editUploadContent');
        const editImagePreview = document.getElementById('editImagePreview');
        const editPreviewImg = document.getElementById('editPreviewImg');
        const editFileName = document.getElementById('editFileName');
        const removeEditImageBtn = document.getElementById('removeEditImage');

        editUploadArea.addEventListener('click', () => {
            if (!editImagePreview.classList.contains('hidden')) return;
            editFileInput.click();
        });

        editFileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleEditFile(e.target.files[0]);
            }
        });

        function handleEditFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                alert('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                editPreviewImg.src = e.target.result;
                editFileName.textContent = file.name;
                editUploadContent.classList.add('hidden');
                editImagePreview.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }

        removeEditImageBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            editFileInput.value = '';
            editUploadContent.classList.remove('hidden');
            editImagePreview.classList.add('hidden');
        });

        // Edit form submission
        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const index = parseInt(document.getElementById('editIndex').value);
            const oldData = savedData[index];
            
            const processUpdate = (imageData, imageName) => {
                const newData = {
                    branchCode: document.getElementById('editBranchCode').value,
                    branchName: '‡∏™‡∏≤‡∏Ç‡∏≤' + document.getElementById('editBranchName').value,
                    district: document.getElementById('editDistrict').value,
                    ipAddress: document.getElementById('editIpAddress').value,
                    imageData: imageData,
                    imageName: imageName,
                    timestamp: oldData.timestamp // Keep original timestamp
                };
                
                // Validate branch code format
                const branchCodePattern = /^[A-Za-z‡∏Å-‡∏Æ0-9]{2}$/;
                if (!branchCodePattern.test(newData.branchCode)) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (A-Z, ‡∏Å-‡∏Æ, 0-9)');
                    return;
                }
                
                // Validate IP format
                const ipPattern = /^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/;
                if (!ipPattern.test(newData.ipAddress)) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å IP Address ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô 192.168.1.100)');
                    return;
                }
                
                // Check for duplicate branch code (excluding current item)
                if (savedData.some((item, i) => i !== index && item.branchCode === newData.branchCode)) {
                    alert('‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏∑‡πà‡∏ô');
                    return;
                }
                
                // Create change details
                let changes = [];
                if (oldData.branchCode !== newData.branchCode) changes.push(`‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤: ${oldData.branchCode} ‚Üí ${newData.branchCode}`);
                if (oldData.branchName !== newData.branchName) changes.push(`‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤: ${oldData.branchName} ‚Üí ${newData.branchName}`);
                if (oldData.district !== newData.district) changes.push(`‡πÄ‡∏Ç‡∏ï: ${oldData.district} ‚Üí ${newData.district}`);
                if (oldData.ipAddress !== newData.ipAddress) changes.push(`IP: ${oldData.ipAddress} ‚Üí ${newData.ipAddress}`);
                if (editFileInput.files[0]) changes.push('‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ IP');
                
                // Update data
                savedData[index] = newData;
                localStorage.setItem('branchData', JSON.stringify(savedData));
                
                // Add log entry
                addLog('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', newData.branchCode, newData.branchName, changes.join(', '));
                
                // Reset and refresh
                document.getElementById('editModal').classList.add('hidden');
                editFileInput.value = '';
                editUploadContent.classList.remove('hidden');
                editImagePreview.classList.add('hidden');
                displayData();
                displayLogData();
                updateDashboard();
                
                alert('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            };
            
            // Handle image update
            if (editFileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    processUpdate(e.target.result, editFileInput.files[0].name);
                };
                reader.readAsDataURL(editFileInput.files[0]);
            } else {
                // Keep existing image
                processUpdate(oldData.imageData, oldData.imageName);
            }
        });

        // Delete data function
        function deleteData(index) {
            const item = savedData[index];
            
            // Request password for deletion
            const password = prompt(`üîê ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤ "${item.branchName}" (${item.branchCode}):`);
            
            // Check password
            if (password !== '348900Ty') {
                if (password !== null) { // User didn't cancel
                    alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }
                return;
            }
            
            // Confirm deletion
            const confirmDelete = confirm(`‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤ "${item.branchName}" (${item.branchCode})?\n\n‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ!`);
            
            if (!confirmDelete) {
                return;
            }
            
            // Add log entry before deletion
            addLog('‡∏•‡∏ö', item.branchCode, item.branchName, `‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤ IP: ${item.ipAddress}, ‡πÄ‡∏Ç‡∏ï: ${item.district}`);
            
            // Remove data
            savedData.splice(index, 1);
            localStorage.setItem('branchData', JSON.stringify(savedData));
            
            // Refresh display
            displayData();
            displayLogData();
            updateDashboard();
            
            // Show success message
            alert('‚úÖ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
        }

        // Download Log Excel function
        document.getElementById('downloadLogBtn').addEventListener('click', function() {
            if (logData.length === 0) {
                alert('‡πÑ‡∏°‡πà‡∏°‡∏µ Log ‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î');
                return;
            }
            
            // Request password for download
            const password = prompt('üîê ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Log Excel:');
            
            // Check password
            if (password !== '348900Ty') {
                if (password !== null) { // User didn't cancel
                    alert('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ');
                }
                return;
            }
            
            // Prepare data for Excel
            const excelLogData = logData.map(log => ({
                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤': log.timestamp,
                '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ': log.user,
                '‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥': log.action,
                '‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤': log.branchCode,
                '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î': log.details
            }));
            
            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(excelLogData);
            
            // Set column widths
            ws['!cols'] = [
                { width: 20 }, // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤
                { width: 20 }, // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                { width: 10 }, // ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥
                { width: 15 }, // ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤
                { width: 50 }  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
            ];
            
            XLSX.utils.book_append_sheet(wb, ws, 'Log ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç');
            
            // Generate filename with current date
            const now = new Date();
            const filename = `Log_‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç_${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}.xlsx`;
            
            // Download file
            XLSX.writeFile(wb, filename);
            
            // Show success message
            alert('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Log ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
        });

        // Initialize display
        displayData();
        displayLogData();
        updateDashboard();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9839fb26d21cd03b',t:'MTc1ODYyOTg2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
